<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <title>ESP Monitor</title>
</head>

<body>
  <div class="container">
    <div class="table-responsive">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th scope="col">Hoário</th>
            <th scope="col">Temperatura</th>
            <th scope="col">Tempo de Porta Aberta</th>
          </tr>
        </thead>
        <tbody id="tbl_log">

        </tbody>
      </table>
    </div>
  </div>
  <script>

    const ws = new WebSocket('wss://espserver.onrender.com');

    ws.addEventListener('open', () => {
      console.log('Conectado ao servidor via WebSocket');
    });

    ws.addEventListener('message', (event) => {
      const data = JSON.parse(event.data);
      let fahrenheit = Number(data.temperatura) * 1.8 + 32;
      let row = $('<tr></tr>');
      $(row).append(`<td>${data.timestamp}</td>`);
      $(row).append(`<td>${data.temperatura}° C / ${fahrenheit}° F</td>`);
      $(row).append(`<td>00:${data.estadoPorta}:00</td>`);
      $('#tbl_log').append(row)
     
    });

    ws.addEventListener('close', () => {
      console.log('Conexão fechada');
    });
  </script>
</body>

</html>